<!DOCTYPE html>
<html>
  <head>
    <title>WAT INTERVIEW</title>
    <!-- Favicon using emoji -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üá∫üá∏</text></svg>"
    />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Custom CSS -->
    <style>
      body {
        background-color: #f8f9fa;
        padding: 20px;
        padding-top: 130px;
      }
      strong {
        color: #0d6efd;
        font-weight: 600;
      }
      .btn-outline-danger:hover {
        background-color: #dc3545;
        color: white;
      }

      .btn-outline-secondary:hover {
        background-color: #6c757d;
        color: white;
      }

      .card {
        margin-bottom: 15px;
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
        height: 100%;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .card-body {
        padding: 15px;
      }
      .row > [class*="col-"] {
        padding-bottom: 20px;
      }
      .card:hover {
        transform: translateY(-5px);
      }
      .question {
        font-weight: 600;
        color: #2c3e50;
        font-size: 1rem;
      }
      .answer {
        display: none;
        margin-top: 15px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #0d6efd;
      }
      .language-toggle {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background-color: rgba(255, 255, 255, 0.95);
        padding: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .badge {
        font-size: 0.9rem;
        padding: 0.35em 0.65em;
        font-weight: 500;
      }
      .language-toggle .btn-danger {
        margin-top: 10px;
        padding: 0.5rem 2rem;
      }
      .btn-group {
        margin-bottom: 10px;
      }
      @media (max-width: 768px) {
        .card {
          margin-bottom: 10px;
        }
        .question {
          font-size: 4rem;
        }
        .card-body {
          padding: 1rem;
        }
        body {
          padding-top: 150px;
        }
      }

      .btn-success {
        background-color: #28a745;
        border-color: #28a745;
      }

      .btn-success:hover {
        background-color: #218838;
        border-color: #1e7e34;
      }

      /* Modal –¥—ç—ç—Ä—Ö —Ç–æ–≤—á–Ω—É—É–¥—ã–Ω –∑–∞–≥–≤–∞—Ä */
      .modal .btn-primary,
      .modal .btn-secondary {
        padding: 0.5rem 1.5rem;
      }

      /* Card –¥—ç—ç—Ä—Ö –∑–∞—Å–∞—Ö/—É—Å—Ç–≥–∞—Ö —Ç–æ–≤—á–Ω—É—É–¥—ã–Ω –∑–∞–≥–≤–∞—Ä */
      .card .btn-outline-secondary,
      .card .btn-outline-danger {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
      }

      /* Container spacing */
      .container-fluid {
        padding: 0 15px;
      }

      /* Card spacing */
      .card {
        margin-bottom: 15px;
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
        height: 100%;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .card-body {
        padding: 15px;
      }

      /* Question spacing */
      .question {
        font-weight: 600;
        color: #2c3e50;
        font-size: 1rem;
      }

      /* Answer spacing */
      .answer {
        display: none;
        margin-top: 15px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #0d6efd;
      }

      /* Mobile device (768px –¥–æ–æ—à) */
      @media (max-width: 767.98px) {
        body {
          padding-top: 120px;
          padding: 10px;
        }

        .container-fluid {
          padding: 0 10px;
        }

        .card {
          margin-bottom: 10px;
        }

        .card-body {
          padding: 12px;
        }

        .question {
          font-size: 0.95rem;
        }

        .answer {
          padding: 12px;
          margin-top: 12px;
          font-size: 0.9rem;
        }

        .btn {
          padding: 0.375rem 0.75rem;
          font-size: 0.875rem;
        }

        .language-toggle {
          padding: 0.75rem;
        }

        .language-toggle .btn {
          padding: 0.25rem 0.5rem;
          font-size: 0.875rem;
        }
      }

      /* Tablet device (768px-991px) */
      @media (min-width: 768px) and (max-width: 991.98px) {
        .col-md-6 {
          padding: 0 10px;
        }
      }

      /* Desktop device (992px –¥—ç—ç—à) */
      @media (min-width: 992px) {
        .col-lg-4 {
          padding: 0 10px;
        }
      }

      /* Language toggle button —Ç–æ—Ö–∏—Ä–≥–æ–æ */
      .language-toggle {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background-color: rgba(255, 255, 255, 0.95);
        padding: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 575.98px) {
        .language-toggle {
          padding: 0.5rem; /* Mobile –¥—ç—ç—Ä padding –±–∞–≥–∞—Å–≥–∞—Ö */
        }

        .language-toggle .btn {
          padding: 0.25rem 0.5rem; /* Button size –±–∞–≥–∞—Å–≥–∞—Ö */
          font-size: 1rem;
        }

        .btn-group {
          margin-bottom: 5px;
        }
      }

      /* Answer button —Ç–æ—Ö–∏—Ä–≥–æ–æ */
      .btn-outline-primary,
      .btn-primary {
        width: 100%; /* Mobile –¥—ç—ç—Ä –±“Ø—Ç—ç–Ω ”©—Ä–≥”©–Ω—Ç—ç–π –±–æ–ª–≥–æ—Ö */
        margin-bottom: 10px;
      }

      @media (max-width: 575.98px) {
        .btn-outline-primary,
        .btn-primary {
          padding: 0.375rem 0.75rem; /* Button size –±–∞–≥–∞—Å–≥–∞—Ö */
          font-size: 0.875rem;
        }
      }

      /* Answer box —Ç–æ—Ö–∏—Ä–≥–æ–æ */
      .answer {
        font-size: 0.9rem; /* Mobile –¥—ç—ç—Ä —Ç–µ–∫—Å—Ç –±–∞–≥–∞—Å–≥–∞—Ö */
        padding: 10px;
        margin-top: 10px;
      }

      /* Speaking button —Ç–æ—Ö–∏—Ä–≥–æ–æ */
      .btn-outline-primary.speaking {
        background-color: #0d6efd;
        color: white;
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      /* Mobile device –¥—ç—ç—Ä—Ö —Ç–æ—Ö–∏—Ä–≥–æ–æ */
      @media (max-width: 767.98px) {
        .btn-group .btn {
          padding: 0.25rem 0.5rem;
        }

        .btn-group .btn i {
          font-size: 0.875rem;
        }
      }

      /* Speaking button styles */
      .btn-outline-info.speaking {
        background-color: #0dcaf0;
        color: white;
        animation: pulse 1.5s infinite;
      }

      .btn-outline-info:hover {
        background-color: #0dcaf0;
        color: white;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Mobile device adjustments */
      @media (max-width: 767.98px) {
        .btn-group .btn {
          padding: 0.25rem 0.5rem;
          margin-right: 2px;
        }

        .btn-group .btn i {
          font-size: 0.875rem;
        }
      }

      /* Speaking button animation */
      .speaking {
        animation: pulse 1.5s infinite;
        background-color: #0d6efd !important;
        color: white !important;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Mobile device adjustments */
      @media (max-width: 767.98px) {
        .btn-sm {
          padding: 0.25rem 0.5rem;
          font-size: 0.75rem;
        }
      }

      /* Speak button styles */
      .btn-speak {
        padding: 0.25rem 0.5rem;
        margin-left: 0.5rem;
        font-size: 0.875rem;
      }

      /* Mobile device adjustments */
      @media (max-width: 767.98px) {
        .btn-speak {
          padding: 0.2rem 0.4rem;
          font-size: 0.75rem;
        }
      }

      /* Add these new styles */
      .selectable {
        cursor: pointer;
        user-select: text;
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
      }

      .selectable:hover {
        background-color: rgba(13, 110, 253, 0.1);
        border-radius: 4px;
      }

      /* Highlight selected text */
      .selectable::selection {
        background-color: rgba(13, 110, 253, 0.2);
      }

      /* Mobile device specific styles */
      @media (max-width: 767.98px) {
        .selectable {
          padding: 2px 4px;
        }
      }

      /* Mobile-specific styles */
      @media (max-width: 767.98px) {
        .selectable {
          -webkit-tap-highlight-color: rgba(13, 110, 253, 0.1);
          padding: 4px;
          margin: 2px 0;
        }

        .btn-speak {
          padding: 4px 8px;
          margin: 2px;
        }

        /* Larger touch targets for mobile */
        .btn-speak i {
          font-size: 1.2em;
        }
      }
    </style>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=d1DTDr2A"></script>
    <script src="uploadData.js"></script>
  </head>
  <body>
    <!-- Header buttons -->
    <div class="text-center mb-4">
      <h1>Wat Interview Questions</h1>
      <button
        class="btn btn-primary me-2"
        data-bs-toggle="modal"
        data-bs-target="#addQuestionModal"
      >
        Add Question
      </button>
      <!-- –ê–¥–º–∏–Ω —Ö—ç—Å—ç–≥—Ç –Ω—ç–º—ç—Ö -->
      <!-- <button
        class="btn btn-warning"
        onclick="uploadQuestionsToFirebase()"
        title="Upload all questions to database"
      >
        <i class="fas fa-upload"></i> Upload Questions
      </button> -->
    </div>

    <!-- Language toggle buttons -->
    <div class="language-toggle text-center mb-4">
      <div class="btn-group">
        <button
          class="btn btn-outline-primary"
          onclick="toggleLanguage('en-answer')"
        >
          English
        </button>
        <button
          class="btn btn-outline-primary"
          onclick="toggleLanguage('mn-answer')"
        >
          –ú–æ–Ω–≥–æ–ª
        </button>
        <button
          class="btn btn-outline-primary px-4"
          onclick="toggleLanguage('both')"
        >
          Both
        </button>
        <button class="btn btn-secondary px-5" onclick="hideAllAnswers()">
          Hide Answers
        </button>
      </div>
    </div>

    <div class="container-fluid">
      <div id="qa-container" class="row">
        <!-- Questions will be loaded here -->
      </div>
    </div>

    <!-- Add Question Modal -->
    <div class="modal fade" id="addQuestionModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New Question</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addQuestionForm">
              <div class="mb-3">
                <label class="form-label">Question:</label>
                <input
                  type="text"
                  class="form-control"
                  id="newQuestionInput"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">English Answer:</label>
                <textarea
                  class="form-control"
                  id="newEnInput"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Mongolian Answer:</label>
                <textarea
                  class="form-control"
                  id="newMnInput"
                  rows="3"
                  required
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="addNewQuestion()"
            >
              Add Question
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Question Modal -->
    <div class="modal fade" id="editQuestionModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Question</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editQuestionForm">
              <div class="mb-3">
                <label class="form-label">Question:</label>
                <input
                  type="text"
                  class="form-control"
                  id="editQuestionInput"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">English Answer:</label>
                <textarea
                  class="form-control"
                  id="editEnInput"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Mongolian Answer:</label>
                <textarea
                  class="form-control"
                  id="editMnInput"
                  rows="3"
                  required
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveEditedQuestion()"
            >
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add data.js script -->
    <!-- <script src="data.js"></script> -->

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
      function boldBracketedText(text) {
        return text.replace(/\[(.*?)\]/g, "<strong>[$1]</strong>");
      }

      function hideAllAnswers() {
        const answers = document.getElementsByClassName("answer");
        for (let answer of answers) {
          answer.style.display = "none";
        }

        // –ó”©–≤—Ö”©–Ω Answer —Ç–æ–≤—á—É—É–¥—ã–Ω —Ç–µ–∫—Å—Ç–∏–π–≥ ”©”©—Ä—á–ª”©—Ö
        const toggleBtns = document.querySelectorAll(
          ".card .btn-outline-primary, .card .btn-primary"
        );
        toggleBtns.forEach((btn) => {
          if (btn.textContent.includes("Answer")) {
            btn.textContent = "Show Answer";
            btn.classList.replace("btn-primary", "btn-outline-primary");
          }
        });

        // Language toggle —Ç–æ–≤—á—É—É–¥—ã–≥ outline –±–æ–ª–≥–æ—Ö
        const langButtons = document.querySelectorAll(".language-toggle .btn");
        langButtons.forEach((btn) => {
          btn.classList.add("btn-outline-primary");
          btn.classList.remove("btn-primary");
        });
      }

      function toggleAnswer(button) {
        const card = button.closest(".card-body");
        const answers = card.getElementsByClassName("answer");
        const isHidden =
          answers[0].style.display === "none" || !answers[0].style.display;

        for (let answer of answers) {
          answer.style.display = isHidden ? "block" : "none";
        }

        // –ó”©–≤—Ö”©–Ω Show/Hide Answer —Ç–æ–≤—á–Ω—ã —Ç–µ–∫—Å—Ç–∏–π–≥ ”©”©—Ä—á–ª”©—Ö
        if (isHidden) {
          button.textContent = "Hide Answer";
          button.classList.replace("btn-outline-primary", "btn-primary");
        } else {
          button.textContent = "Show Answer";
          button.classList.replace("btn-primary", "btn-outline-primary");
        }
      }

      function toggleLanguage(lang) {
        const buttons = document.querySelectorAll(".language-toggle .btn");
        buttons.forEach((btn) => {
          if (
            btn.textContent.toLowerCase().includes(lang) ||
            (lang === "both" && btn.textContent === "Both")
          ) {
            btn.classList.add("btn-primary");
            btn.classList.remove("btn-outline-primary");
          } else {
            btn.classList.add("btn-outline-primary");
            btn.classList.remove("btn-primary");
          }
        });

        const answers = document.getElementsByClassName("answer");
        for (let answer of answers) {
          if (lang === "both" || answer.classList.contains(lang)) {
            answer.style.display = "block";
          } else {
            answer.style.display = "none";
          }
        }

        // –ê—Å—É—É–ª—Ç –±“Ø—Ä–∏–π–Ω Show/Hide —Ç–æ–≤—á–Ω—ã —Ç–µ–∫—Å—Ç–∏–≥ —à–∏–Ω—ç—á–ª—ç—Ö
        const toggleBtns = document.querySelectorAll(
          ".card .btn-outline-primary, .card .btn-primary"
        );
        toggleBtns.forEach((btn) => {
          if (btn.textContent.includes("Answer")) {
            // –ó”©–≤—Ö”©–Ω Answer —Ç–æ–≤—á—É—É–¥—ã–≥ —à–∏–Ω—ç—á–ª—ç—Ö
            if (lang === "both" || answers[0].style.display === "block") {
              btn.textContent = "Hide Answer";
              btn.classList.replace("btn-outline-primary", "btn-primary");
            } else {
              btn.textContent = "Show Answer";
              btn.classList.replace("btn-primary", "btn-outline-primary");
            }
          }
        });
      }

      // DOM –∞—á–∞–∞–ª–∞–≥–¥—Å–∞–Ω—ã –¥–∞—Ä–∞–∞ createCards –¥—É—É–¥–∞—Ö
      document.addEventListener("DOMContentLoaded", function () {
        createCards();
      });

      // Function to speak selected text
      function speakSelectedText(text) {
        if (!window.responsiveVoice) {
          alert("Text to speech is not available!");
          return;
        }

        // Clean the text
        text = text.trim().replace(/[\n\r]+/g, " ");

        // Speak the text
        responsiveVoice.speak(text, "UK English Female", {
          pitch: 1,
          rate: 0.9,
          volume: 1,
        });
      }

      // Function to add double-click listeners
      function addDoubleClickListeners() {
        document.querySelectorAll(".selectable").forEach((element) => {
          element.addEventListener("dblclick", function (e) {
            // Get the clicked text
            let selection = window.getSelection();
            let selectedText = selection.toString();

            // If no text is selected, get the clicked word
            if (!selectedText) {
              let text = e.target.innerText;
              let range = document.createRange();
              range.selectNodeContents(e.target);
              selection.removeAllRanges();
              selection.addRange(range);
              selectedText = selection.toString();
            }

            if (selectedText) {
              // Stop any current speech
              responsiveVoice.cancel();

              // Speak the selected text
              speakSelectedText(selectedText);
            }
          });
        });
      }

      // Add this to ensure listeners are added after dynamic content loads
      document.addEventListener("DOMContentLoaded", () => {
        addDoubleClickListeners();
      });
    </script>

    <!-- Firebase SDK - —Ö–∞–º–≥–∏–π–Ω —ç—Ö—ç–Ω–¥ –±–∞–π—Ä–ª—É—É–ª–∞—Ö -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- Firebase —Ç–æ—Ö–∏—Ä–≥–æ–æ -->
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyD5NiYHI_2xPQvaOna_mwqCfmdDXFKOBhU",
        authDomain: "watinterview-34f9c.firebaseapp.com",
        projectId: "watinterview-34f9c",
        storageBucket: "watinterview-34f9c.firebasestorage.app",
        messagingSenderId: "255575163715",
        appId: "1:255575163715:web:17b0fdc071b6e1baf2e5f6",
        measurementId: "G-YNX8QW25DH",
      };

      // Firebase initialize
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    </script>

    <!-- Questions data -->
    <script type="module" src="./questions.js"></script>

    <!-- Upload script -->
    <script type="module" src="./uploadData.js"></script>

    <!-- Main script -->
    <script type="module">
      import {
        initializeDatabase,
        createCards,
        editQuestion,
        deleteQuestion,
        addNewQuestion,
      } from "./uploadData.js";

      // Make functions available globally
      window.editQuestion = editQuestion;
      window.deleteQuestion = deleteQuestion;
      window.addNewQuestion = addNewQuestion;

      // Initialize when DOM is loaded
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          await createCards();
        } catch (error) {
          console.error("Initialization error:", error);
        }
      });
    </script>

    <!-- Add this before closing body tag -->
    <script>
      // Make speakText function globally available
      window.speakText = function (button, type) {
        // Check if running on mobile
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

        // Check ResponsiveVoice
        if (!window.responsiveVoice) {
          console.error("ResponsiveVoice is not loaded!");
          return;
        }

        // First try to initialize voice on mobile
        if (isMobile) {
          responsiveVoice.init();
        }

        // Cancel any ongoing speech
        responsiveVoice.cancel();

        // Add speaking animation
        button.classList.add("speaking");

        let textToSpeak = "";
        const card = button.closest(".card-body");

        try {
          if (type === "question") {
            textToSpeak = card
              .querySelector(".question")
              .textContent.replace(/\d+\.\s/, "")
              .replace(/üîí/g, "")
              .trim();
          } else if (type === "answer") {
            const answerText = button.parentElement.textContent.trim();
            textToSpeak = answerText.replace(/Listen/g, "").trim();
          }

          // Clean the text
          textToSpeak = textToSpeak.replace(/[\n\r]+/g, " ").trim();

          console.log("Speaking:", textToSpeak); // Debug log

          // Mobile-specific settings
          const voiceOptions = {
            pitch: 1,
            rate: 0.9,
            volume: 1,
            onend: () => {
              button.classList.remove("speaking");
            },
            onerror: (e) => {
              console.error("Speech error:", e);
              button.classList.remove("speaking");
              if (isMobile) {
                alert("Please enable sound permissions and try again.");
              }
            },
          };

          // Try to speak
          const success = responsiveVoice.speak(
            textToSpeak,
            "UK English Female",
            voiceOptions
          );

          if (!success) {
            console.error("Failed to start speech");
            button.classList.remove("speaking");

            if (isMobile) {
              // Try to trigger user interaction for mobile
              alert("Tap OK to enable voice feature");
              responsiveVoice.speak(
                textToSpeak,
                "UK English Female",
                voiceOptions
              );
            }
          }
        } catch (error) {
          console.error("Speech error:", error);
          button.classList.remove("speaking");
        }
      };

      // Double-click/tap handler
      function handleTextSelection(e) {
        if (!window.responsiveVoice) {
          console.error("ResponsiveVoice is not loaded!");
          return;
        }

        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

        try {
          let selectedText = "";

          if (isMobile) {
            // For mobile, get the clicked element's text
            selectedText = e.target.textContent.trim();
          } else {
            // For desktop, get selected text
            selectedText = window.getSelection().toString().trim();
          }

          if (selectedText) {
            responsiveVoice.cancel(); // Stop any current speech

            const success = responsiveVoice.speak(
              selectedText,
              "UK English Female",
              {
                pitch: 1,
                rate: 0.9,
                volume: 1,
                onerror: (e) => console.error("Speech error:", e),
              }
            );

            if (!success && isMobile) {
              // Try to trigger user interaction for mobile
              alert("Tap OK to enable voice feature");
              responsiveVoice.speak(selectedText, "UK English Female", {
                pitch: 1,
                rate: 0.9,
                volume: 1,
              });
            }
          }
        } catch (error) {
          console.error("Speech error:", error);
        }
      }

      // Add event listeners for text selection
      function addTextListeners() {
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

        document.querySelectorAll(".selectable").forEach((element) => {
          if (isMobile) {
            // Single tap for mobile
            element.addEventListener("click", handleTextSelection);
          } else {
            // Double click for desktop
            element.addEventListener("dblclick", handleTextSelection);
          }
        });
      }

      // Initialize when document is ready
      document.addEventListener("DOMContentLoaded", () => {
        // Check if ResponsiveVoice is loaded
        if (window.responsiveVoice) {
          console.log("ResponsiveVoice is ready");

          // Try to initialize voice
          responsiveVoice.init();

          // Add text selection listeners
          addTextListeners();
        } else {
          console.error("ResponsiveVoice is not available");
        }
      });
    </script>

    <script>
      // Global variables
      let firestoreQuestions = [];

      // Create cards function
      window.createCards = function () {
        try {
          const container = document.getElementById("qa-container");
          container.innerHTML = "";

          firestoreQuestions.forEach((data, index) => {
            const card = document.createElement("div");
            card.className = "col-12 col-md-6 col-lg-4";

            const formattedEnAnswer = boldBracketedText(data.en);
            const formattedMnAnswer = boldBracketedText(data.mn);

            const protectedIcon = data.isProtected
              ? '<i class="fas fa-lock text-warning ms-2" title="Protected Question"></i>'
              : "";

            card.innerHTML = `
              <div class="card h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title question selectable">
                      ${index + 1}. ${data.question}
                      ${protectedIcon}
                      <button class="btn btn-speak btn-outline-primary" onclick="speakText(this, 'question')" title="Listen">
                        <i class="fas fa-volume-up"></i>
                      </button>
                    </h5>
                    <div class="btn-group">
                      <button class="btn btn-outline-secondary btn-sm" onclick="editQuestion('${
                        data.id
                      }')" title="Edit">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-outline-danger btn-sm" onclick="deleteQuestion('${
                        data.id
                      }')" title="Delete">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                  <button class="btn btn-outline-primary mb-2" onclick="toggleAnswer(this)">
                    Show Answer
                  </button>
                  <div class="answer en-answer selectable" style="display: none;" data-lang="en">
                    ${formattedEnAnswer}
                    <button class="btn btn-speak btn-outline-primary" onclick="speakText(this, 'answer')" title="Listen">
                      <i class="fas fa-volume-up"></i>
                    </button>
                  </div>
                  <div class="answer mn-answer" style="display: none;" data-lang="mn">
                    ${formattedMnAnswer}
                  </div>
                </div>
              </div>
            `;

            container.appendChild(card);
          });

          // Add double-click listeners after creating cards
          addDoubleClickListeners();
        } catch (error) {
          console.error("Error creating cards:", error);
          throw error;
        }
      };

      // Helper function for text formatting
      function boldBracketedText(text) {
        if (!text) return "";
        return text.replace(/\[([^\]]+)\]/g, "<strong>$1</strong>");
      }

      // Initialize when document is ready
      document.addEventListener("DOMContentLoaded", () => {
        if (window.responsiveVoice) {
          console.log("ResponsiveVoice is ready");
          // Note: createCards will be called after data is loaded from Firestore
        } else {
          console.error("ResponsiveVoice is not available");
        }
      });
    </script>
  </body>
</html>
